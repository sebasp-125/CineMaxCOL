@model CineMaxCOL_Web.Models.PuestosYReservas.DTO_PuestosYReservar

@{
    int capacidad = 20;
}

        @foreach(var item in Model.sillasPorFuncions){
                    <h1>@item.IdFuncion + @Model.funcionDto.Id</h1>
                break;
                }

<div class="bg-gray-100 min-h-screen py-10">
    <div class="bg-white max-w-4xl mx-auto p-6 rounded-lg shadow-md">
        <div class="w-full h-6 bg-gray-400 mt-8 text-center font-semibold flex items-center justify-center rounded">
            Pantalla
        </div>

        <div class="flex space-x-6 mt-4 justify-center">
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-gray-500 rounded-full"></div>
                <span>Disponible</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-blue-600 rounded-full"></div>
                <span>Seleccionado</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-red-500 rounded-full"></div>
                <span>Ocupado</span>
            </div>
        </div>
        <h2 class="text-2xl font-bold mb-6 text-center">Selecciona tu silla</h2>

        @if (!Model.sillasPorFuncions.Any())
        {
            <p>Por este momento tenemos problemas...</p>
        }
        else
        {
            @foreach (var item in Model.sillasPorFuncions)
            {
                var color = item.Estado == "Reservado" ? "bg-red-500" :
                item.Estado == "Temporal" ? "bg-yellow-300" :
                "bg-green-500";
                <a href="@Url.Action("ReservarTemporalmente" , "SelectingPositions" , new 
                {
                    idFuncion = item.IdFuncion,
                    IdSillaPorFuncion = item.IdSillaNavigation.Id
                })" class="border p-2 m-1 rounded text-white @color">
                    @($"{item.IdSillaNavigation.Fila}{item.IdSillaNavigation.Numero}")
                </a>
            }
        }


        <div class="mt-10 w-full space-y-2">
            <a href="@Url.Action("Index", "PaymentdGetAway")" class="btn btn-success w-full">Pagar</a>
            <button class="btn btn-error w-full" onclick="Abandonar()">Abandonar</button>
        </div>

        <div class="collapse bg-base-100 border border-base-300">
            <input type="radio" name="my-accordion-1" checked="checked" />
            <div class="collapse-title font-semibold text-center">Información sobre
                @Model.funcionDto.IdPeliculaNavigation?.Titulo</div>
            <div class="collapse-content text-sm">
                <div class="max-w-md mx-auto my-6">
                    <div class="card shadow-xl bg-base-100">
                        <div class="card-body">
                            <h2 class="card-title text-2xl font-bold">Función #@Model.funcionDto.Id</h2>
                            <div class="space-y-2">
                                <p><span class="font-semibold">Sala:</span> @Model.funcionDto.IdSalaNavigation?.Nombre
                                </p>
                                <p><span class="font-semibold">Película:</span>
                                    @Model.funcionDto.IdPeliculaNavigation?.Titulo</p>
                                <p><span class="font-semibold">Fecha y hora:</span>
                                    @Model.funcionDto.FechaHora?.ToString("g")</p>
                                <p><span class="font-semibold">Precio:</span> $@Model.funcionDto.Precio?.ToString("F2")
                                </p>
                                <p><span class="font-semibold">Identificador:</span>
                                    @Model.funcionDto.IdentificadorMovies</p>
                                <p><span class="font-semibold">Creado el:</span>
                                    @Model.funcionDto.CreatedAt?.ToString("dd/MM/yyyy HH:mm")</p>
                                <p>
                                    <span>Seleccionadas: </span>
                                    <span id="reservesAccount"></span>
                                </p>
                                <p>
                                    <span>Total a pagar: </span>
                                    <span id="AllPayme"></span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>



<script>
    document.addEventListener("DOMContentLoaded", function () {
        const selectedSeats = JSON.parse(localStorage.getItem("SelectedSeats")) || [];

        selectedSeats.forEach(id => {
            const btn = document.getElementById("seat-" + id);
            if (btn) {
                btn.classList.remove("bg-gray-500");
                btn.classList.add("bg-blue-600");
            }
        });

        updateSeatList(selectedSeats);
    });

    function Selecting(id) {
        let selectedSeats = JSON.parse(localStorage.getItem("SelectedSeats")) || [];
        const btn = document.getElementById("seat-" + id);

        if (!selectedSeats.includes(id)) {
            selectedSeats.push(id);
            btn.classList.remove("bg-gray-500");
            btn.classList.add("bg-blue-600");
        } else {
            selectedSeats = selectedSeats.filter(item => item !== id);
            btn.classList.remove("bg-blue-600");
            btn.classList.add("bg-gray-500");
        }

        localStorage.setItem("SelectedSeats", JSON.stringify(selectedSeats));
        updateSeatList(selectedSeats);
    }

    function updateSeatList(seats) {
        const seatDisplay = document.getElementById("reservesAccount");
        seatDisplay.textContent = seats.join(", ");

        @* const precio = parseFloat('@Model.Precio'.replace(',', '.')); *@
        const total = seats.length * precio;
        document.getElementById("AllPayme").textContent = "$" + total.toFixed(2);
    }

    function Abandonar() {
        localStorage.removeItem("SelectedSeats");
        location.reload();
    }

</script>
